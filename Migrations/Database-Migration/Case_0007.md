
# ğŸ“Œ Case #7: Cassandra â†’ ScyllaDB

**Real companies: Discord, Samsung, Comcast, Bloomberg**

This is what teams do when they say:

> â€œWe like Cassandraâ€™s modelâ€¦
> we hate Cassandraâ€™s operations.â€

---

## 1ï¸âƒ£ Original Setup

### Companies

* **Discord** â€“ real-time messaging at insane scale
* **Samsung** â€“ telemetry & device data
* **Comcast** â€“ event ingestion
* **Bloomberg** â€“ time-series & internal systems

### Initial Database

**Apache Cassandra**

### Why Cassandra Was Chosen

* Linear horizontal scalability
* High write throughput
* Partition-based data model
* Tunable consistency
* Battle-tested at scale

### Typical Cassandra Cluster

```
App
 â†“
Cassandra Ring
(Node1 â†” Node2 â†” Node3 â†” Node4)
```

On paper? Beautiful.
In production? Painful.

---

## 2ï¸âƒ£ The Breaking Point

### ğŸš¨ What Actually Broke

#### 1. JVM-Based Performance

* Garbage collection pauses
* Heap tuning nightmares
* Latency spikes under load

ğŸ§  Cassandra doesnâ€™t fail fast â€” it degrades **mysteriously**.

---

#### 2. Operational Complexity

* Manual repairs
* Compaction tuning
* Token management
* Rolling upgrades are scary

On-call engineers suffered.

---

#### 3. Hardware Inefficiency

* Cassandra uses only a fraction of CPU
* Overprovisioning became normal
* Cloud bills skyrocketed

ğŸ’¥ **Key realization**

> â€œOur CPUs are idle, but latency is bad.â€

---

## 3ï¸âƒ£ Why ScyllaDB?

### What Is ScyllaDB?

**ScyllaDB = Cassandra-compatible, rewritten in C++**

Key differences:

* No JVM
* Shared-nothing, shard-per-core design
* Predictable latency
* Better hardware utilization

### Why Not Rewrite Everything?

* Cassandra data model already works
* Query patterns already defined
* Migration risk too high

### Why ScyllaDB Won

| Feature       | Cassandra | ScyllaDB       |
| ------------- | --------- | -------------- |
| Language      | Java      | C++            |
| GC pauses     | Yes       | No             |
| CPU usage     | Low       | Near 100%      |
| Latency       | Spiky     | Predictable    |
| Compatibility | â€”         | CQL compatible |

ğŸ§  Discord publicly stated ScyllaDB gave them **order-of-magnitude efficiency gains**.

---

## 4ï¸âƒ£ Architecture Before vs After

### ğŸ”´ Before (Cassandra)

```
App
 â†“
Cassandra Ring
 â†“
JVM GC + Compaction
```

### ğŸŸ¢ After (ScyllaDB)

```
App
 â†“
ScyllaDB Cluster
 â†“
Shard-per-core execution
```

Same architecture conceptually â€” very different behavior.

---

## 5ï¸âƒ£ Code-Level Changes (Minimal, Thatâ€™s the Point)

### Cassandra CQL

```sql
CREATE TABLE messages (
  channel_id TEXT,
  message_id TIMEUUID,
  user_id TEXT,
  content TEXT,
  PRIMARY KEY (channel_id, message_id)
) WITH CLUSTERING ORDER BY (message_id DESC);
```

### ScyllaDB

ğŸ”¥ **Exact same CQL**

No schema changes.
No query rewrites.

Thatâ€™s why this migration is attractive.

---

### Client Code (Unchanged)

```python
session.execute("""
  SELECT *
  FROM messages
  WHERE channel_id = %s
  LIMIT 50
""", (channel_id,))
```

ğŸ§  **This is rare in migrations** â€” behavior changes without code changes.

---

## 6ï¸âƒ£ Migration Strategy (How Real Teams Do It)

### Safe, Production-Grade Steps

1. Spin up ScyllaDB cluster
2. Mirror schema
3. Dual writes (Cassandra + ScyllaDB)
4. Stream historical data
5. Compare latency & correctness
6. Switch reads
7. Decommission Cassandra

âš ï¸ Many teams keep Cassandra around briefly as fallback.

---

## 7ï¸âƒ£ Hidden Pitfalls (Donâ€™t Skip This)

| Pitfall                    | Reality               |
| -------------------------- | --------------------- |
| Assumed full compatibility | Some edge CQL differs |
| Repair strategy            | Different tuning      |
| Monitoring                 | New metrics           |
| Operational mindset        | Still NoSQL           |
| Bad data model             | Scylla wonâ€™t fix it   |

ğŸ§  ScyllaDB fixes **performance**, not **bad schemas**.

---

## 8ï¸âƒ£ Final Outcome

### What Improved

âœ” 10â€“20Ã— better latency
âœ” Predictable performance
âœ” Better hardware utilization
âœ” Lower cloud costs

### What Didnâ€™t

âœ˜ Same query limitations
âœ˜ Same data modeling discipline
âœ˜ Still eventual consistency

### When NOT to Migrate

* Small clusters
* Poorly understood access patterns
* Teams unwilling to re-learn ops

---

## ğŸ¯ Interview Preparation Section

### Interview Question

> â€œWhy move from Cassandra to ScyllaDB?â€

**Strong Answer**

> â€œTo retain Cassandraâ€™s data model while eliminating JVM-related latency and improving hardware efficiency.â€

### Bonus Points

* Shard-per-core
* No GC pauses
* CQL compatibility
* Predictable latency

---

## ğŸ‘¨â€ğŸ’» Production Engineer Lessons

* Language/runtime matters at scale
* GC is the silent killer of latency SLAs
* Compatibility migrations are rare gems
* Faster systems donâ€™t forgive bad design

---

