
# ğŸ“Œ Case #5: Oracle â†’ PostgreSQL

**Real companies & orgs: Fujitsu, NTT, Red Hat, Skype (partial), multiple EU governments**

âš ï¸ Important honesty upfront
Very few companies â€œrip Oracle out in one goâ€.
Most do **gradual, workload-by-workload migrations**.

That itself is a **senior-engineer lesson**.

---

## 1ï¸âƒ£ Original Setup

### Who Actually Did This?

* **Fujitsu** â€“ internal enterprise systems
* **NTT Data** â€“ customer-facing systems
* **Red Hat** â€“ internal tooling & services
* **Skype** â€“ moved several services away from Oracle
* **European governments** â€“ cost & vendor lock-in driven

These migrations are **well-documented in enterprise circles**, not flashy blogs.

---

### Why Oracle Was Chosen Initially

Oracle made perfect sense **10â€“20 years ago**:

* Rock-solid ACID guarantees
* Powerful optimizer
* Mature tooling
* Excellent support (at a price)
* Trusted by banks & governments

### Typical Oracle Architecture

```
Enterprise Apps
   â†“
Oracle RAC
   â†“
Standby / DR
```

This setup is **technically excellent**.

The problem was **everything around it**.

---

## 2ï¸âƒ£ The Breaking Point (Why Oracle Had to Go)

### ğŸš¨ Real Pain Points

#### 1. Licensing Cost Explosion

* Per-core licensing
* Extra cost for:

  * Partitioning
  * Advanced security
  * RAC
* Cloud usage made costs **unpredictable**

ğŸ’¥ Bills reached **millions per year**.

---

#### 2. Vendor Lock-in

* Proprietary SQL (PL/SQL)
* Oracle-specific tooling
* Hard to hire Oracle experts
* Cloud-native integration was painful

---

#### 3. Cloud Migration Friction

* Oracle licensing + AWS/GCP = nightmare
* Scaling down didnâ€™t reduce cost
* DR setups were extremely expensive

---

#### 4. Overkill for Many Workloads

Many systems:

* Didnâ€™t need RAC
* Didnâ€™t need extreme HA
* Needed **cost-effective correctness**, not premium everything

ğŸ§  **Key realization**

> â€œWe are paying Ferrari prices for city driving.â€

---

## 3ï¸âƒ£ Why PostgreSQL?

### Requirements That Emerged

| Requirement     | Needed |
| --------------- | ------ |
| ACID guarantees | âœ…      |
| Open-source     | âœ…      |
| Strong SQL      | âœ…      |
| Cloud-friendly  | âœ…      |
| Lower cost      | âœ…      |
| Extensible      | âœ…      |

### Why PostgreSQL Won

* Enterprise-grade correctness
* No licensing traps
* Strong community
* JSONB + relational
* Runs *everywhere*

### Why Not MySQL?

* Weaker constraint culture
* Less advanced SQL features
* PostgreSQL closer to Oracle semantics

---

## 4ï¸âƒ£ Architecture Before vs After

### ğŸ”´ Before (Oracle)

```
Apps
 â†“
Oracle RAC
 â†“
DR Site
```

* Expensive
* Operationally heavy
* Vendor-locked

---

### ğŸŸ¢ After (PostgreSQL)

```
Apps
 â†“
PostgreSQL Primary
 â†“
Streaming Replicas
 â†“
Cloud Backups
```

* Simpler
* Cheaper
* Cloud-native
* Good enough HA for most workloads

---

## 5ï¸âƒ£ Code-Level Migration (This Is Where Pain Lives)

### Example: Stored Procedure

#### Oracle PL/SQL

```sql
CREATE OR REPLACE PROCEDURE update_balance(
  p_user_id IN NUMBER,
  p_amount  IN NUMBER
) AS
BEGIN
  UPDATE accounts
  SET balance = balance + p_amount
  WHERE user_id = p_user_id;

  COMMIT;
END;
```

Problems:

* Embedded commits
* Oracle-specific syntax
* Tight DB coupling

---

### PostgreSQL Version (PL/pgSQL)

```sql
CREATE OR REPLACE FUNCTION update_balance(
  p_user_id BIGINT,
  p_amount  NUMERIC
) RETURNS VOID AS $$
BEGIN
  UPDATE accounts
  SET balance = balance + p_amount
  WHERE user_id = p_user_id;
END;
$$ LANGUAGE plpgsql;
```

ğŸ§  **Key change**

* Transactions move to application layer
* DB logic simplified
* Better control and testability

---

### Data Type Mapping (Interview Favorite)

| Oracle   | PostgreSQL       |
| -------- | ---------------- |
| NUMBER   | NUMERIC / BIGINT |
| VARCHAR2 | TEXT             |
| CLOB     | TEXT             |
| DATE     | TIMESTAMPTZ      |
| SEQUENCE | SEQUENCE         |

---

## 6ï¸âƒ£ Migration Strategy (How Enterprises Actually Do It)

### âŒ What They Donâ€™t Do

* Big-bang migration
* Rewrite everything
* Touch mission-critical core first

### âœ… What They Actually Do

#### Phase 1: Identify Low-Risk Systems

* Reporting
* Internal tools
* Read-heavy services

#### Phase 2: Dual Run

* Oracle = source of truth
* PostgreSQL = shadow copy
* Compare results

#### Phase 3: Cut Over

* Move ownership to PostgreSQL
* Archive Oracle data

#### Phase 4: Repeat

One system at a time.

âš ï¸ Oracle stays for **years** during transition.

---

## 7ï¸âƒ£ Hidden Pitfalls (Enterprise Reality)

| Pitfall               | Reality                    |
| --------------------- | -------------------------- |
| PL/SQL logic          | Often massive              |
| Implicit commits      | Must redesign              |
| Optimizer differences | Queries behave differently |
| Pagination            | Oracle â‰  PostgreSQL        |
| Sequences             | Behavior differs           |

### Example: Pagination Rewrite

**Oracle**

```sql
SELECT *
FROM (
  SELECT t.*, ROWNUM rn
  FROM table t
)
WHERE rn BETWEEN 10 AND 20;
```

**PostgreSQL**

```sql
SELECT *
FROM table
OFFSET 10
LIMIT 10;
```

---

## 8ï¸âƒ£ Final Outcome

### What Improved

âœ” Massive cost reduction (often 70â€“90%)
âœ” Cloud portability
âœ” Easier hiring
âœ” Cleaner architectures

### What Got Worse

âœ˜ Migration time (months/years)
âœ˜ Loss of some Oracle-only features
âœ˜ Cultural resistance

### When NOT to Migrate

* Extreme HA requirements
* Regulatory constraints
* Deep Oracle dependency

---

## ğŸ¯ Interview Preparation Section

### Interview Question

> â€œWhy do enterprises move from Oracle to PostgreSQL?â€

**Strong Answer**

> â€œTo reduce licensing costs, avoid vendor lock-in, and move toward cloud-native architectures while retaining strong transactional guarantees.â€

### Bonus Points

* PL/SQL â†’ app logic
* Gradual migration
* Cost predictability
* PostgreSQL extensions

---

## ğŸ‘¨â€ğŸ’» Production Engineer Lessons

* Cost is a technical constraint
* Vendor lock-in is real debt
* Open-source wins long-term
* Migrations are political as much as technical

---

